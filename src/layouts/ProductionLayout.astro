---
import BaseLayout from "./BaseLayout.astro";
import ProductionHeader from "../components/ProductionHeader.astro";
import "../styles/markdown.css";

const { frontmatter } = Astro.props;
---

<BaseLayout title={frontmatter.title}>
  <ProductionHeader 
    title={frontmatter.title}
    year={frontmatter.year}
    role={frontmatter.role}
    company={frontmatter.company}
    image={frontmatter.image}
    platforms={frontmatter.platforms}
    software={frontmatter.software}
  />
  <article class="markdown-content">
    <slot />
  </article>

  <!-- Lightbox -->
  <div id="lightbox" class="lightbox">
    <img id="lightbox-img" src="" alt="" />
  </div>

  <script>
    const lightbox = document.getElementById('lightbox');
    const lightboxImg = document.getElementById('lightbox-img') as HTMLImageElement;
    const allImages = document.querySelectorAll('.markdown-content img');

    allImages.forEach(img => {
      // Don't add lightbox if the image is inside a link
      if (img.closest('a')) return;

      img.addEventListener('click', () => {
        lightboxImg.src = (img as HTMLImageElement).src;
        lightbox.classList.add('active');
        document.body.style.overflow = 'hidden'; // Prevent scrolling
      });
    });

    lightbox?.addEventListener('click', () => {
      lightbox.classList.remove('active');
      document.body.style.overflow = ''; // Restore scrolling
    });

    // Close on Escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && lightbox.classList.contains('active')) {
        lightbox.classList.remove('active');
        document.body.style.overflow = '';
      }
    });
  </script>
</BaseLayout>
